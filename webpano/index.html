<!doctype html>
<html>
  <head>
    <title>VR set</title>
  </head>
  <body>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="//aframe.io/releases/0.4.0/aframe.min.js"></script>

    <a-scene>
      <a-sky id='mjpeg' src='panomini.png'></a-sky>
    </a-scene>

    <script type="text/javascript">
      //
      // MJPEG
      //
      var $mjpeg =$("#mjpeg");
      
      var localhost=location.host;
      var ip = localhost.substring(0,localhost.indexOf(':'));
      var ip_img="http://"+ip+":80";

      //setTimeout("$mjpeg[0].outerHTML =\"<a-sky id='mjpeg' src='convmini.png'></a-sky>\";", 5000);
      //setTimeout("$mjpeg[0].outerHTML =\"<a-sky id='mjpeg' src='panomini.png'></a-sky>\";", 5000);
      //var imgsrc='pano.png';
      var i=0;

      function myloop(){
      setTimeout(function () {    //  call a 3s setTimeout when the loop is called
          if (i%2==1)
            $mjpeg[0].outerHTML = "<a-sky id=\"mjpeg\" src='panomini.png'></a-sky>";          //  your code here
          else 
            $mjpeg[0].outerHTML = "<a-sky id=\"mjpeg\" src='convmini.png'></a-sky>";          //  your code here
          $mjpeg =$("#mjpeg");
          i++;  
          if (i < 10) {            //  if the counter < 10, call the loop function
            myloop();
          }                        //  ..  setTimeout()
        }, 100);
      }
      //VR.panorama(imgsrc);

      $(function() {
        myloop();
          //reload_img();
          //updatePreview(true);
      });

      function toggle_fullscreen(e) {

          var background = document.getElementById("background");

          if(!background) {
              background = document.createElement("div");
              background.id = "background";
              document.body.appendChild(background);
          }
        
          if(e.className == "fullscreen") {
              e.className = "";
              background.style.marginTop = 0 + 'px';
          }
          else {
              e.className = "fullscreen";
              background.style.marginTop = 50 + 'px';
          }
      }

      function reload_img () {
          if(!halted) 
          {
              $mjpeg_img[0].src = ip_img+"/cam_pic.php?time=" + new Date().getTime() + "&pDelay=" + preview_delay;
          }
          else 
          {
              setTimeout("reload_img()", 500);
          }
      }


      function error_img () {
          setTimeout("mjpeg_img.src  = "+ip_img +"'/cam_pic.php?time='       + new Date().getTime();", 100);
      }

      function updatePreview(cycle)
      {
          if (cycle !== undefined && cycle == true)
          {
              $mjpeg_img[0].src = ip_img+"/updating.jpg";
              setTimeout("$mjpeg_img[0].src = \" " + ip_img + "/cam_pic_new.php?time=\"       + new Date().getTime()  + \"&pDelay=\" + preview_delay;", 1000);
              return;
          }
        
          if (previous_halted != halted)
          {
              if(!halted)
              {
                  $mjpeg_left_img[0].src  = ip_img +"/cam_pic.php?time="       + new Date().getTime() + "&pDelay=" + preview_delay;
              }
              else
              {
                  $mjpeg_img[0].src  = ip_img +"/updating.jpg";
              }
          }
          previous_halted = halted;

      }
    </script>
  </body>
</html>
